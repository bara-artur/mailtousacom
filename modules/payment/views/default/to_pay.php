<?php
use yii\helpers\Url;
use yii\helpers\Html;
use yii\bootstrap\Modal;
use kartik\grid\GridView;
use johnitvn\ajaxcrud\CrudAsset;
use johnitvn\ajaxcrud\BulkButtonWidget;
use yii\widgets\Pjax;
use yii\bootstrap\ActiveForm;
use yii\widgets\DetailView;
use app\components\ParcelPrice;
use kartik\widgets\DatePicker;


/* @var $this yii\web\View */
/* @var $searchModel app\modules\orderInclude\models\OrderIncludeSearch */
/* @var $dataProvider yii\data\ActiveDataProvider */

$this->title = 'Order payment';
$this->params['breadcrumbs'][] = $this->title;


$submitOption = [
  'class' => 'btn btn-lg btn-success'
];

$form = ActiveForm::begin([
  'options' => ['class'=>''],
  'validateOnChange' => true,
]);
?>
<h4 class="modernui-neutral2">Order payment</h4>
<div class="row">
<div class="col-md-offset-4 col-md-4">
  <div class="trans_text text-center font-weight-600">
  Please pay your MailToUSA fees
  </div>
  <?php
  foreach ($payments_list as $pay){
    ?>
      <p><b>package source type</b> <?=$pay["source_text"];?></p>
      <?php
        if($pay["track_number_type"]==0){
          ?>
          <p><b>Generated by us</b>______</p>
          <?php
        }else {
          ?>
          <p><b>track number</b> <?= $pay["track_number"]; ?></p>
          <?php
        }
      ?>
      <p><b>weight</b><?=$pay["weight"];?> Lb</p>
    <?php
  }
  ?>
    <div class="trans_text text-center">
        Sum to pay: <span class="trans_count"><?=number_format($total['sum']+$total['gst']+$total['qst'],2);?>$</span>&nbsp;&nbsp;(included vat <?=number_format($total['gst']+$total['qst']);?>$)
    </div>
    <hr class="podes">

  <?php
    if(Yii::$app->user->identity->isManager()){?>
      <div class="col-md-offset-2 trans_text custom-radio">
      <?= Html::radioList('payment_type',null,
        [
          1 => "PayPal",
          2 => "I will pay at warehouse"
        ],[
          'item' => function($index, $label, $name, $checked, $value) {

            $return = '<label>';
            $return .= '<input type="radio" name="' . $name . '" value="' . $value . '">';
            $return .= '<span></span>&nbsp;&nbsp;';
            $return .= ucwords($label);
            $return .= '</label><br>';
            return $return;
          }
        ]
      );
      ?>
      </div>
    <?php
    }else{
      if($model->payment_state!=0){
        ?>
          <h4>
            The order has already been paid.
          </h4>
        <?php
        echo Html::hiddenInput('payment_type', -1, []);
      }else{
        ?>
        <h4>
          The order has not been paid yet. Take payment in cash.
        </h4>
        <?php
        $pay_text="The customer paid me the order.";
        echo Html::hiddenInput('payment_type', 3, []);
      }
    }?>
</div>
    </div>
<hr>
<div class="row">
    <div class="col-md-12">
<div class="form-group">
    <?=Html::a('<i class="glyphicon glyphicon-chevron-left"></i> Back', ['/orderInclude/border-form/'.$order_id], ['class' => 'btn btn-default pull-left']) ?>
<?php
  if(Yii::$app->user->identity->isManager()){
    echo Html::a('Return to orders list', ['/'], ['class' => 'btn btn-default pull-left']);
    if($model->order_status<2){
      echo Html::submitButton($pay_text.'Accept the order for the receiving point.', ['class' => $model->isNewRecord ? 'btn btn-success' : 'btn btn-success pull-right']);
    }

  }else{
    echo Html::submitButton('Next <i class="glyphicon glyphicon-chevron-right"></i>', ['class' => $model->isNewRecord ? 'btn btn-success' : 'btn btn-success pull-right']);
  }
    ?>
</div>
</div>
</div>

<?php ActiveForm::end(); ?>